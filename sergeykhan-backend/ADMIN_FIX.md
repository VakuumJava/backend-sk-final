# РЕШЕНИЕ ПРОБЛЕМЫ С АДМИНИСТРАТОРОМ

## Проблема
При развертывании Django приложения на Railway администраторская учетная запись не создается или недоступна для входа.

## Причины проблемы

1. **Несоответствие в названии роли**: В коде была ошибка - использовалась роль `'super_admin'` вместо `'super-admin'`
2. **Отсутствие переменных окружения**: Суперпользователь создается только при наличии переменных `DJANGO_SUPERUSER_EMAIL` и `DJANGO_SUPERUSER_PASSWORD`
3. **Ошибки в процессе создания пользователя**

## Исправления

### 1. Исправлена команда set_admin_password.py
- Изменена роль с `'super_admin'` на `'super-admin'`
- Добавлено автоматическое создание суперпользователя, если он не существует

### 2. Улучшен скрипт startup.sh
- Добавлена более надежная обработка создания суперпользователя
- Добавлен fallback для создания администратора по умолчанию

### 3. Созданы новые команды управления
- `create_admin.py` - для создания/обновления администратора
- `list_users.py` - для просмотра всех пользователей

## Способы решения

### Способ 1: Установить переменные окружения в Railway

В настройках Railway добавьте переменные:
```
DJANGO_SUPERUSER_EMAIL=your-email@example.com
DJANGO_SUPERUSER_PASSWORD=your-secure-password
```

### Способ 2: Использовать команду create_admin

После развертывания выполните в Railway Console:
```bash
python manage.py create_admin --email="admin@sergeykhan.kz" --password="admin123"
```

### Способ 3: Использовать данные по умолчанию

После последнего обновления кода, при следующем развертывании будет создан администратор по умолчанию:
- **Email**: admin@sergeykhan.kz
- **Пароль**: admin123

### Способ 4: Проверить существующих пользователей

Выполните команду для просмотра всех пользователей:
```bash
python manage.py list_users
```

## Проверка решения

1. Зайдите в админ панель: `https://your-app.railway.app/admin/`
2. Используйте данные:
   - Email: admin@sergeykhan.kz
   - Пароль: admin123

## Дополнительные команды

```bash
# Создать нового администратора
python manage.py create_admin --email="new-admin@example.com" --password="new-password"

# Просмотреть всех пользователей
python manage.py list_users

# Обновить пароль существующего администратора
python manage.py set_admin_password
```

## Структура модели пользователя

Проект использует кастомную модель пользователя `CustomUser` с ролями:
- 'master' - Мастер
- 'operator' - Оператор  
- 'warrant-master' - Гарантийный мастер
- **'super-admin' - Супер админ** (для доступа в админ панель)
- 'curator' - Куратор

## Важные моменты

1. Аутентификация происходит по email, а не по username
2. Модель пользователя находится в `api1.models.CustomUser`
3. Для входа в админ панель пользователь должен иметь роль `'super-admin'` и флаги `is_staff=True`, `is_superuser=True`
