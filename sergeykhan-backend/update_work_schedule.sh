#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –º–∞—Å—Ç–µ—Ä–æ–≤ —Å 8 –¥–æ 12 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã
# –ó–∞–ø—É—Å–∫: bash update_work_schedule.sh

echo "üïò –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –º–∞—Å—Ç–µ—Ä–æ–≤ –¥–æ 12-—á–∞—Å–æ–≤–æ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è..."

# –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏
echo "üìÇ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π..."
python3 manage.py makemigrations
python3 manage.py migrate

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."
python3 manage.py shell << EOF
from api1.models import MasterDailySchedule
from datetime import time

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
updated_schedules = MasterDailySchedule.objects.filter(work_end_time=time(21, 0))
old_schedules = MasterDailySchedule.objects.filter(work_end_time=time(17, 0))

print(f"‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π: {updated_schedules.count()}")
print(f"‚ö†Ô∏è  –°—Ç–∞—Ä—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π –æ—Å—Ç–∞–ª–æ—Å—å: {old_schedules.count()}")

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
if updated_schedules.exists():
    schedule = updated_schedules.first()
    print(f"üìÖ –ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:")
    print(f"   –ú–∞—Å—Ç–µ—Ä: {schedule.master.email}")
    print(f"   –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: {schedule.work_start_time} - {schedule.work_end_time}")
    print(f"   –ú–∞–∫—Å–∏–º—É–º —Å–ª–æ—Ç–æ–≤: {schedule.max_slots}")
EOF

echo ""
echo "üéâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo ""
echo "üìù –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:"
echo "   ‚Ä¢ –†–∞–±–æ—á–∏–π –¥–µ–Ω—å –º–∞—Å—Ç–µ—Ä–æ–≤: 09:00 - 21:00 (–±—ã–ª–æ 09:00 - 17:00)"
echo "   ‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—Ç–æ–≤ –≤ –¥–µ–Ω—å: 12 (–±—ã–ª–æ 8)"
echo "   ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã: 18:00-19:00, 19:00-20:00, 20:00-21:00"
echo ""
echo "üîÑ –ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥!"
